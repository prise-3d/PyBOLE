

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A tour of PyBOLE &mdash; PyBOLE v1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=3de69b8c" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=aabfef7a"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script src="_static/js/custom.js?v=807ba70f"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Create an experiment from scratch" href="example.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PyBOLE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">A tour of PyBOLE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-concepts">Main concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notion-of-template">Notion of template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#experiments">Experiments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#experiment-process">Experiment process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#page-creation">Page creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#associate-styles-and-javascript">Associate styles and Javascript</a></li>
<li class="toctree-l3"><a class="reference internal" href="#page-data-access-into-template">Page data access into template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#session">Session</a></li>
<li class="toctree-l2"><a class="reference internal" href="#session-progress-principle">Session Progress principle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-representation-of-a-sessionprogress">The representation of a SessionProgress</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary-of-data-access-from-pages">Summary of data access from pages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-sessionprogress">Custom SessionProgress</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-method">Start method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#next-method">Next method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#progress-method">Progress method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#end-method">End method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-examples">Other examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Create an experiment from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="usages.html">Advanced usages</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyBOLE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">A tour of PyBOLE</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/prise-3d/PyBOLE/blob/master/docs/source/documentations.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-tour-of-pybole">
<h1>A tour of PyBOLE<a class="headerlink" href="#a-tour-of-pybole" title="Permalink to this heading"></a></h1>
<p>This documentation will allow you to get to know the framework and the administrator interface. It will detail the concepts and the idea behind the abstraction for the creation of online experiments.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is highly recommended to read this documentation in parallel with the administrator interface (which is available at <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/admin</span></code>, more specifically for the management of experiments in <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/admin/experiments</span></code>).</p>
</div>
<p>In order to fully understand how the interface of the proposed application works, you can run it on example data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>db.example.sqlite3<span class="w"> </span>db.sqlite3
</pre></div>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>It will erase your default admin account.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The website will now be composed of a set of example data.</p>
</div>
<p>You can log in to the administrator interface with the following credentials:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>username:<span class="w"> </span>adminuser
password:<span class="w"> </span>adminuser
</pre></div>
</div>
<section id="main-concepts">
<h2>Main concepts<a class="headerlink" href="#main-concepts" title="Permalink to this heading"></a></h2>
<p>This is a main overview of the important components of the framework:</p>
<a class="reference internal image-reference" href="_images/overall_explanation.png"><img alt="_images/overall_explanation.png" class="align-center" src="_images/overall_explanation.png" style="width: 80%;" /></a>
<p>Here a description of each principal components:</p>
<ul class="simple">
<li><p><strong>Experiment:</strong> represents the architecture of the experiment with the associated pages (more details will be provided later), a JSON configuration of the experiment (path to data for example), a description and an availability status. An experiment is composed of 4 specific pages;</p></li>
<li><p><strong>Session:</strong> an experiment can be attached to several sessions. Indeed, it can be wished that the experiment is available for different populations and/or that the stopping criterion of the experiment is different (time of the experiment). A JSON configuration is associated to a session and it also has an availability status (can also be active or not);</p></li>
<li><p><strong>SessionProgress:</strong> is one of the most important entities, it is at the heart of the application’s operation. It allows the link between a session and a participant. When a participant wants to perform an experiment through a session, a new SessionProgress instance is created. This instance will manage the exchanges with the user, transmit the next stimulus to the user and define the stop of the experiment according to the stop criteria specified in the session. A SessionProgress, contains several SessionSteps, which store the user’s response for each new stimulus transmitted.</p></li>
<li><p><strong>Participant:</strong> thanks to a unique identifier stored both on the client’s browser and in the database, it is possible to know the status of the experiments performed by this participant.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Treating the participant in this way ensures the anonymization of the data.</p>
</div>
<p><strong>Important note:</strong> inside the django admin interface, you can manage some entities: Experiment, Session and Pages. Note that the SessionProgress entity need to be coded (this is the only part that requires Python code).</p>
<p>With this insight, we will now go into more detail to understand how to create your own experiment</p>
</section>
<section id="notion-of-template">
<h2>Notion of template<a class="headerlink" href="#notion-of-template" title="Permalink to this heading"></a></h2>
<p>First, we need to take a look at a very important concept of Django: the notion of <code class="docutils literal notranslate"><span class="pre">template</span></code>. A <strong>template</strong> is an html page with a particular way of displaying data sent from the Django server. This is a common way in order to display data to the client in Django.</p>
<p>The following figure describe the process:</p>
<a class="reference internal image-reference" href="_images/server_template.png"><img alt="_images/server_template.png" class="align-center" src="_images/server_template.png" style="width: 80%;" /></a>
<p>Here is an example of how Django works:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">render_template_with_data</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Route available at `/experiment`</span>
<span class="sd">    Choose template and returns expected data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;My experiment title&quot;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;templates/experiment.html&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>The template code example:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>...
<span class="cm">&lt;!-- displays return data using key --&gt;</span>
<span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{ experiment }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
...
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t worry, you won’t need to create Django queries, however, you will create templates if needed to specify the display you want.</p>
</div>
</section>
<section id="experiments">
<h2>Experiments<a class="headerlink" href="#experiments" title="Permalink to this heading"></a></h2>
<p>The introduction to templates is important because we have mentioned in the main concepts that an experiment is composed of pages.</p>
<section id="experiment-process">
<h3>Experiment process<a class="headerlink" href="#experiment-process" title="Permalink to this heading"></a></h3>
<p>Indeed, an experiment is composed of 4 pages:</p>
<a class="reference internal image-reference" href="_images/pages.png"><img alt="_images/pages.png" class="align-center" src="_images/pages.png" style="width: 95%;" /></a>
<ul class="simple">
<li><p><strong>The information page:</strong> it may be necessary to ask some information from the participant, or to inform him about certain aspects of the experiment. This is what the hint page allows;</p></li>
<li><p><strong>The example page:</strong> which provides instructions for a good understanding of the participating experiment. It can be visible without going through the experiment;</p></li>
<li><p><strong>The main page:</strong> this is where the experiment will unfold, it will receive the new stimulus at each step, and will ask the participant to respond accordingly;</p></li>
<li><p><strong>The end page:</strong> when the SessionProgress instance determines the end of the participant’s experiment session, the end page is proposed to the participant.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each page is composed of a name and a title, the name is used to identify the page on the admin interface side, the title is used on the client side.</p>
</div>
</section>
<section id="page-creation">
<h3>Page creation<a class="headerlink" href="#page-creation" title="Permalink to this heading"></a></h3>
<p>It is possible to create a particular page from the administrator interface (<code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/admin/experiments</span></code>). Each page requires a particular template and can be selected at creation. Each variable entered in the page configuration can be displayed in a particular template.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In order for an experiment to be created, it must be associated with each of the requested pages (information, example, main and end).</p>
</div>
<p>The folder <code class="docutils literal notranslate"><span class="pre">experiments/templates/pages</span></code> contains all the Django templates currently available for pages. Each sub-folder: <code class="docutils literal notranslate"><span class="pre">end</span></code>, <code class="docutils literal notranslate"><span class="pre">examples</span></code>, <code class="docutils literal notranslate"><span class="pre">information</span></code>, <code class="docutils literal notranslate"><span class="pre">main</span></code> is associated with a particular type of page. This is how the <em>admin</em> interface provides you with only the possible templates.</p>
<p>The structure of a page template for Django is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s1">&#39;pages/page_base.html&#39;</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">static</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">apptags</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">content</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Your</span> <span class="n">specific</span> <span class="n">page</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For a new template to be taken into account in the administrator interface, the server must be restarted.</p>
</div>
</section>
<section id="associate-styles-and-javascript">
<h3>Associate styles and Javascript<a class="headerlink" href="#associate-styles-and-javascript" title="Permalink to this heading"></a></h3>
<p>When you have access to the creation url to add a page (<code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/admin/experiments/mainpage/add/</span></code>), it is possible to specify its content, its template, but also the style and javascript files that will be loaded for this page:</p>
<a class="reference internal image-reference" href="_images/styles_and_javascripts.png"><img alt="_images/styles_and_javascripts.png" class="align-center" src="_images/styles_and_javascripts.png" style="width: 60%;" /></a>
<p>In this way, as illustrated, it is possible to select several style and javascript files which will be loaded for the page.</p>
<p>It is possible to add as many style scripts and javascripts as necessary in the folder: <code class="docutils literal notranslate"><span class="pre">static/experiment</span></code> of the project.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For a new style or javascript file to be taken into account in the administrator interface, the server must be restarted.</p>
</div>
</section>
<section id="page-data-access-into-template">
<h3>Page data access into template<a class="headerlink" href="#page-data-access-into-template" title="Permalink to this heading"></a></h3>
<p>A JSON field is configurable when you create or modify your page. It allows to store some static data. This JSON configuration is accessible from your template thanks to the Django <code class="docutils literal notranslate"><span class="pre">page</span></code> object, and more specifically the <code class="docutils literal notranslate"><span class="pre">content</span></code> field of the <code class="docutils literal notranslate"><span class="pre">page</span></code> instance.</p>
<p>This is a JSON configuration example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My first example page&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;number_of_questions&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;expected_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>with its template data access:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;justify-content-center&quot;</span><span class="p">&gt;</span>

        <span class="cm">&lt;!-- Page Heading --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;py-2 text-center&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>{{page.content | from_json:&quot;description&quot;}}<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- Keep in this scope a new `params_obj` object which stores `params` JSON field data --&gt;</span>
            {% with params_obj=page.content|from_json:&quot;params&quot; %}
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Number of questions: {{params_obj | from_json:&quot;number_of_questions&quot;}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Expected time: {{params_obj | from_json:&quot;expected_time&quot;}} minutes<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endwidth %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the end of this tutorial, a summary of the data accessible by type of page will be provided.</p>
</div>
</section>
</section>
<section id="session">
<h2>Session<a class="headerlink" href="#session" title="Permalink to this heading"></a></h2>
<p>As mentioned, the session is associated with an experiment, i.e. it remains associated with the 4 pages that compose the experiment. The main interest of the Session division is that an experiment can be carried out with different parameters (number of iterations, stopping time criteria) with different populations.</p>
<p>When creating a session from the administrator interface (<code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/admin/experiments/session/add/</span></code>), it is possible to associate it with the desired experiment, propose a specific configuration, an estimated duration and a very important item, the way the experiment progresses: a specific <code class="docutils literal notranslate"><span class="pre">SessionProgress</span></code> model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We’ll get into the details of SessionProgress model next.</p>
</div>
<p>For now, let’s focus on the fact that the current configuration of our session is as follows:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;max_iterations&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We will use this configuration to specify that the participant will be confronted with a maximum of 20 stimili (i.e. 20 iterations).</p>
</section>
<section id="session-progress-principle">
<h2>Session Progress principle<a class="headerlink" href="#session-progress-principle" title="Permalink to this heading"></a></h2>
<p>For the moment, it is not possible to create our <code class="docutils literal notranslate"><span class="pre">Session</span></code>, as it lacks the essential component for the proper functioning of the planned experiment: a <code class="docutils literal notranslate"><span class="pre">SessionProgress</span></code> model. There are a few examples of this model in the <code class="docutils literal notranslate"><span class="pre">experiments/experiments</span></code> folder, but here we will describe how it works.</p>
<section id="the-representation-of-a-sessionprogress">
<h3>The representation of a SessionProgress<a class="headerlink" href="#the-representation-of-a-sessionprogress" title="Permalink to this heading"></a></h3>
<p>A SessionProgress is composed of 4 main methods as detailed below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SessionProgress</span><span class="p">():</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">participant_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define and init some progress variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define next step data object taking into account current step and answer</span>

<span class="sd">        Return: JSON data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">progress</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the percent progress of the experiment</span>

<span class="sd">        Return: float progress between [0, 100]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether it&#39;s the end or not of the experiment</span>

<span class="sd">        Return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>The figure below details where the methods of the SessionProgress instance are realized:</p>
<a class="reference internal image-reference" href="_images/global_scheme.png"><img alt="_images/global_scheme.png" class="align-center" src="_images/global_scheme.png" style="width: 95%;" /></a>
<p>Additional information is provided below to help you understand the proposed scheme:</p>
<ul class="simple">
<li><p>First, the specific instance of <code class="docutils literal notranslate"><span class="pre">SessionProgress</span></code> is created when the experiment session is launched;</p></li>
<li><p>Once the information page is validated by the participant, the <code class="docutils literal notranslate"><span class="pre">start</span></code> method is called to retrieve the entered information;</p></li>
<li><p>The example page is then presented;</p></li>
<li><p>Once the instructions have been validated, the first stimulus is proposed to the participant (first call of the method <code class="docutils literal notranslate"><span class="pre">next</span></code>);</p></li>
<li><p>Then, as long as the <code class="docutils literal notranslate"><span class="pre">end</span></code> method does not determine that the experiment is finished, a new stimulus (obtained from a new call <code class="docutils literal notranslate"><span class="pre">next</span></code> method) is proposed to the participant on the main page of the experiment. The progress indicator of the experiment (<code class="docutils literal notranslate"><span class="pre">progress</span></code> method) is also transmitted to the template of the main page;</p></li>
<li><p>Finally, if the <code class="docutils literal notranslate"><span class="pre">end</span></code> method specifies an end of experiment, the participant is redirected to the end of experiment page.</p></li>
</ul>
</section>
<section id="summary-of-data-access-from-pages">
<h3>Summary of data access from pages<a class="headerlink" href="#summary-of-data-access-from-pages" title="Permalink to this heading"></a></h3>
<p>Before presenting a concrete example of an experiment implementation, let’s specify which variables are accessible on each of the 4 possible pages:</p>
<ul>
<li><p><strong>Information, Example, and End pages:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><strong>page</strong>: the current information page instance;</p></li>
<li><p><strong>experiment</strong>: the current selected experiment;</p></li>
<li><p><strong>progress</strong>: the current SessionProgress instance;</p></li>
<li><p><strong>session</strong>: the selected session.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Main page:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><strong>page</strong>: the current information page instance;</p></li>
<li><p><strong>experiment</strong>: the current selected experiment;</p></li>
<li><p><strong>progress</strong>: the current SessionProgress instance;</p></li>
<li><p><strong>session</strong>: the selected session;</p></li>
<li><p><strong>progress_info</strong>: the computed progress percent from the <code class="docutils literal notranslate"><span class="pre">result</span></code> method of SessionProgress;</p></li>
<li><p><strong>step</strong>: the specific SessionStep data (stimilus data).</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="custom-sessionprogress">
<h2>Custom SessionProgress<a class="headerlink" href="#custom-sessionprogress" title="Permalink to this heading"></a></h2>
<p>Now that the concept of the progression of an experiment has been explained, let’s look technically at how each method works. We will create a class called <code class="docutils literal notranslate"><span class="pre">ClassicalSessionProgress</span></code> which inherits the attributes and behaviors of <code class="docutils literal notranslate"><span class="pre">SessionProgress</span></code>. In this new class, we will define the 4 necessary methods: start, next, progress and end.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">..models</span><span class="w"> </span><span class="kn">import</span> <span class="n">SessionProgress</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ClassicalSessionProgress</span><span class="p">(</span><span class="n">SessionProgress</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<section id="start-method">
<h3>Start method<a class="headerlink" href="#start-method" title="Permalink to this heading"></a></h3>
<p>Let’s start with the following example of the information page:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- Page Heading --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>{{page.content|from_json:&quot;question&quot;}}<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row justify-content-md-center&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xs-6 col-md-offset-3&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;experiments:load_example&#39; slug=experiment.slug session_id=session.id progress_id=progress.id %}&quot;</span><span class="p">&gt;</span>
        {% csrf_token %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;basic-select-glasses&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span><span class="p">&gt;</span>Do you wear glasses?<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;basic-info-glasses&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;basic-select-glasses&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Default select example&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="na">selected</span><span class="p">&gt;</span>No<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;</span>Yes<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-auto&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary mb-3&quot;</span><span class="p">&gt;</span>Start experiment<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">csrf_token</span> <span class="pre">%}</span></code>: avoid the CSRF vulnerability;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">url</span> <span class="pre">'experiments:load_example'</span> <span class="pre">...</span> <span class="pre">%}</span></code> enables to redirect to the example page with the three specific parameters (experiment, session and progress identifiers).</p></li>
</ul>
</div>
<p>This information page contains a POST form and sends data about the participant (here the information of the wearing of glasses or not). The <code class="docutils literal notranslate"><span class="pre">start</span></code> method of SessionProgress retrieves a parameter that stores all this data.</p>
<p>This data can be processed and saved in the JSON field <code class="docutils literal notranslate"><span class="pre">data</span></code> of the SessionProgress instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">participant_data</span><span class="p">):</span>

    <span class="c1"># need to be initialized in order to start experiment</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># keep in memory number of iteration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;glasses&#39;</span><span class="p">:</span> <span class="n">participant_data</span><span class="p">[</span><span class="s1">&#39;basic-info-glasses&#39;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># always save state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that in this example, we also initialize in the SessionProgress data an indicator of the number of iterations performed, initially set to 0.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Django uses a database to store information about the different models it manages. The <code class="docutils literal notranslate"><span class="pre">save</span></code> method, allows to specify a persistence of these data. It is important to use it at the end of the method.</p>
</div>
</section>
<section id="next-method">
<h3>Next method<a class="headerlink" href="#next-method" title="Permalink to this heading"></a></h3>
<p>Once the SessionProgress instance is initialized, it is possible to predict which stimulus can be returned according to different criteria. Here, to simplify the example, we use a random stimuli.</p>
<p>Let’s use a main page with the following response form at each step of the experiment:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;binary-answer-form&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xs-6 col-md-offset-3&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;experiments:run_session&#39; slug=experiment.slug session_id=session.id progress_id=progress.id %}&quot;</span><span class="p">&gt;</span>
    {% csrf_token %}
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;binary-answer-time&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;binary-answer-value&quot;</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-auto&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-danger btn-icon-split&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon text-white-50&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fas fa-times-circle&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">&gt;</span>No identicals<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-auto&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success btn-icon-split&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon text-white-50&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fas fa-check&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">&gt;</span>Identicals<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>As it stands, the response and time fields have no value. It is a preference, because we want to get the exact response time. For that, we rely on javascript which will capture the response time and transmit it before sending (this is a proposal, there may be others):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// keep track of start step time (once document is loaded)</span>
<span class="w">    </span><span class="nx">start_answer_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// manage the current form in order to store answer and time</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;form[class=&quot;binary-answer-form&quot;]&#39;</span><span class="p">).</span><span class="nx">onsubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// get answer from button</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">answer_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

<span class="w">        </span><span class="c1">// Compute time and add it into form</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">answer_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start_answer_time</span>

<span class="w">        </span><span class="c1">// set specific input values before sending data</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;binary-answer-time&quot;]&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">answer_time</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;binary-answer-value&quot;]&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">answer_value</span>

<span class="w">        </span><span class="c1">// then submit form</span>
<span class="w">        </span><span class="nx">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
<span class="w">        </span><span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">next</span></code> method of SessionProgress is the most important, because it takes into account how the next stimilus will be presented, but also the update of the previous stimilus. The <code class="docutils literal notranslate"><span class="pre">step</span></code> and <code class="docutils literal notranslate"><span class="pre">answer</span></code> parameters provide this information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>

<span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

    <span class="c1"># 1. update previous step depending of answer (if previous step exists)</span>
    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">answer_time</span> <span class="o">=</span> <span class="n">answer</span><span class="p">[</span><span class="s1">&#39;binary-answer-time&#39;</span><span class="p">]</span>
        <span class="n">answer_value</span> <span class="o">=</span> <span class="n">answer</span><span class="p">[</span><span class="s1">&#39;binary-answer-value&#39;</span><span class="p">]</span>

        <span class="n">step</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;answer_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">answer_time</span>
        <span class="n">step</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;answer_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">answer_value</span>
        <span class="n">step</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c1"># 2. process next step data (can be depending of answer)</span>

    <span class="c1"># folder of images could also stored into experiment config</span>
    <span class="n">cornel_box_path</span> <span class="o">=</span> <span class="s1">&#39;resources/images/cornel_box&#39;</span>
    <span class="c1"># need to take care of static media folder</span>
    <span class="n">images_path</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cornel_box_path</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">RELATIVE_STATIC_URL</span><span class="p">,</span> <span class="n">cornel_box_path</span><span class="p">))</span>
            <span class="p">])</span>

    <span class="c1"># right image always display reference</span>
    <span class="c1"># prepare next step data</span>
    <span class="n">step_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;left_image&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">images_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">500</span>
        <span class="p">},</span>
        <span class="s2">&quot;right_image&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">images_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">500</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># increment iteration into progress data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># always save state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">step_data</span>
</pre></div>
</div>
<p>The data returned from the <code class="docutils literal notranslate"><span class="pre">next</span></code> method is then accessible in the main page from the <code class="docutils literal notranslate"><span class="pre">step.data</span></code> field:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row py-2 justify-content-md-center text-center&quot;</span><span class="p">&gt;</span>
    <span class="cm">&lt;!-- Display images --&gt;</span>
    {% with left_img=step.data|from_json:&quot;left_image&quot; %}

        <span class="cm">&lt;!-- Set same height to div in order to avoid buttons flickering.. --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xl-5 col-md-5 mb-4&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: {{left_img|from_json:&#39;height&#39;}}px&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;experiment-image&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{% static left_img|from_json:&#39;src&#39; %}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;{{left_img|from_json:&#39;width&#39;}}px&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;{{left_img|from_json:&#39;height&#39;}}px&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {% endwith %}

    {% with right_img=step.data|from_json:&quot;right_image&quot; %}

        <span class="cm">&lt;!-- Set same height to div in order to avoid buttons flickering.. --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-xl-5 col-md-5 mb-4&quot;</span>  <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: {{right_img|from_json:&#39;height&#39;}}px&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;experiment-image&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{% static right_img|from_json:&#39;src&#39; %}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;{{right_img|from_json:&#39;width&#39;}}px&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;{{right_img|from_json:&#39;height&#39;}}px&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {% endwith %}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Let’s summarize what is done:</p>
<ul class="simple">
<li><p>A call to the <code class="docutils literal notranslate"><span class="pre">next</span></code> method has been made and stimulus data has been prepared. Only the data is prepared because there is no previous step and response (first call to the step method);</p></li>
<li><p>The number of iteration is then increased by one;</p></li>
<li><p>A form on the main page is available to answer the presented stimulus (here a binary answer);</p></li>
<li><p>The use of Javascript allows to recover a reliable response time: time between the presentation of the stimulus and the response (click on a response button);</p></li>
<li><p>The old state and the response information are passed to the <code class="docutils literal notranslate"><span class="pre">next</span></code> method. It is thus possible to update the responses obtained in the previous state (SessionStep);</p></li>
<li><p>Finally, the new stimulus is prepared to transmit the information to the template and the current number of iteration is increment.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that just like the SessionProgress, a SessionStep has a JSON <code class="docutils literal notranslate"><span class="pre">data</span></code> field to store the iteration information (response information and presented data). Note that the next stimulus information, by default, are stored when the next SessionStep is created.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The path where the images are stored (<cite>static</cite> folder), must not be specified for the image to be loaded in the template. It should be used to retrieve information (<code class="docutils literal notranslate"><span class="pre">settings.RELATIVE_STATIC_URL</span></code>), but not specified in the data send.</p>
</div>
</section>
<section id="progress-method">
<h3>Progress method<a class="headerlink" href="#progress-method" title="Permalink to this heading"></a></h3>
<p>The progress method is fairly simple, but provides a clear understanding of the relationship between the SessionProgress and its associated Session. The purpose of this method is to return an indicator of the percentage of progress of the experiment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">progress</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>

    <span class="c1"># access of session&#39;s config from current SessionProgress instance</span>
    <span class="n">total_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;max_iterations&#39;</span><span class="p">])</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">])</span>

    <span class="c1"># return percent of session advancement</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">/</span> <span class="n">total_iterations</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
<p>Since there is a relationship between our SessionProgress and the Session it is associated with, it is possible to retrieve the session configuration and therefore the <code class="docutils literal notranslate"><span class="pre">max_iterations</span></code> we defined earlier.</p>
</section>
<section id="end-method">
<h3>End method<a class="headerlink" href="#end-method" title="Permalink to this heading"></a></h3>
<p>As you have guessed, the <code class="docutils literal notranslate"><span class="pre">end</span></code> method is not the most complicated one. In this example, we will check the number of iterations and specify if the experiment is finished or not:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

    <span class="n">total_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;max_iterations&#39;</span><span class="p">])</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">iteration</span> <span class="o">&gt;=</span> <span class="n">total_iterations</span>
</pre></div>
</div>
<p>This is of course only an example, but it is totally possible to save a time when the SessionProgress is created (<code class="docutils literal notranslate"><span class="pre">start</span></code> method) and verify it. In this case, the duration of the experiment is not targeted on a number of iterations, but rather a temporal duration.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When the server starts, it will retrieve all the specific models of the <code class="docutils literal notranslate"><span class="pre">SessionProgress</span></code> abstract model and propose them for the creation of a <code class="docutils literal notranslate"><span class="pre">Session</span></code>. For any new creation of <code class="docutils literal notranslate"><span class="pre">SessionProgress</span></code> Model, the server must be restarted.</p>
</div>
<p>In order to update the new proposed model in database, you need to do migrations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre></div>
</div>
</section>
<section id="other-examples">
<h3>Other examples<a class="headerlink" href="#other-examples" title="Permalink to this heading"></a></h3>
<p>Other examples of <code class="docutils literal notranslate"><span class="pre">SessionProgress</span></code> are available within the project: <a class="reference external" href="https://github.com/prise-3d/behavioral-online-experiment/tree/master/experiments/experiments">examples</a>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="example.html" class="btn btn-neutral float-right" title="Create an experiment from scratch" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Jérôme BUISINE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>